"use strict";(self.webpackChunkbattleship=self.webpackChunkbattleship||[]).push([[301],{301:(at,T,d)=>{d.r(T),d.d(T,{BattleshipModule:()=>nt});var u=d(808),b=d(342),f=d(340);class a{static error(i){f.N.logLevel>0&&console.error(`:::LOGGER:::ERROR:: ${i}`)}static warn(i){f.N.logLevel>1&&console.warn(`:::LOGGER:::WARN:: ${i}`)}static info(i){f.N.logLevel>2&&console.log(`:::LOGGER:::INFO:: ${i}`)}static debug(i){f.N.logLevel>3&&console.log(`:::LOGGER:::DEBUG:: ${i}`)}}var o=d(223),p=(()=>{return(e=p||(p={})).CLEAN="clean",e.HIT="hit",e.DESTROYED="destroyed",e.FAIL="fail",p;var e})(),c=(()=>{return(e=c||(c={})).RIGHT="right",e.LEFT="left",e.UP="up",e.DOWN="down",c;var e})();class m{toString(){let i="";try{i=JSON.stringify(this)}catch(t){this.throwError(`error to try transform ${this.constructor.name} to string`)}return i}throwError(i){throw new Error(`[${this.constructor.name}]: ${i}`)}}class N extends m{constructor(i){super(),this._position=i,this._state=p.CLEAN,this._isShip=!1}get isShip(){return this._isShip}get state(){return this._state}get position(){return this._position}setState(i){this._state=i}setShip(){this._isShip=!0}}class F extends m{constructor(i,t){super(),this.x=i,this.y=t}}class J extends m{constructor(i=0){super(),this._positions=[],this._size=i,this._hits=0}get size(){return this._size?this._size:this._positions.length}get positions(){return this._positions}get hits(){return this._hits}get isDestroyed(){return this._hits===this.size}build(i){0===i.length&&this.throwError("positions can not be empty."),this._size>0&&this._size!==i.length&&this.throwError(`positions length should be ${this._size} instead ${i.length}`),this._positions.length>0&&this.throwError("this ship is already builded."),this._positions=i}hit(){this._hits++}}class L extends m{constructor(i){super(),this._position=i}get position(){return this._position}}class l{static createPosition(i,t){return new F(i,t)}static createShip(i){return new J(i)}static createShot(i){return new L(i)}static createCellBoard(i){return new N(i)}static createGameBoard(i,t){return new U(i,t)}static addPosition(i,t){let s;switch(t){case c.RIGHT:s=l.createPosition(i.x+1,i.y);break;case c.LEFT:s=l.createPosition(i.x-1,i.y);break;case c.UP:s=l.createPosition(i.x,i.y+1);break;case c.DOWN:s=l.createPosition(i.x,i.y-1);break;default:s=i}return s}}const v=e=>{let i=Math.floor(Math.random()*e)-1;return i>=0?i:0},x=[c.RIGHT,c.LEFT,c.DOWN,c.UP];class U extends m{constructor(i,t){super(),this._dimension=i,this._unBuildedShips=t,this._board=[],this._ships=[],this.build()}get dimension(){return this._dimension}get board(){return this._board}get ships(){return this._ships}build(){this._board=this.createGameBoard(),this.buildShips(this._board)}createGameBoard(){let i,t=[];for(let s=0;s<this._dimension;s++){i=[];for(let r=0;r<this._dimension;r++){let n=l.createPosition(s,r),g=l.createCellBoard(n);i.push(g)}t.push(i)}return t}buildShips(i){const t=s=>{let r=this.createShipPositions(s.size,i);return s.build(r),i=this.insertShipOnBoard(s,i),s};this._ships=this._unBuildedShips.map(s=>t(s))}createShipPositions(i,t){return 1===i?[this.createEmptyPosition(t)]:this.findPositions(i,t)}findPositions(i,t,s=0){1e3===s&&this.throwError("can create position for this ship."),s++;let k,S,r=this.createEmptyPosition(t),n=[r],g=r,O=i,A=x.length,Z=0,y=v(x.length),G=1,M=!1,E=!1;for(;!M;){let I=!1;k=x[y],S=l.addPosition(g,k),g.toString()!==S.toString()&&(I=this.isEmptyPosition(S,t)),I?(g=S,n.push(S),G++):(n=[r],g=r,G=1,Z++,y++),y>A&&(y=0),Z===A&&(E=!0,M=!0),G===O&&(M=!0)}return E?this.findPositions(i,t,s):n}createEmptyPosition(i){let t=this.createRandomPosition();return this.isEmptyPosition(t,i)?t:this.createEmptyPosition(i)}createRandomPosition(){let i=v(this._dimension),t=v(this._dimension);return l.createPosition(i,t)}isEmptyPosition(i,t){try{let s=t[i.x][i.y],{isShip:r}=s;return!r}catch(s){return!1}}insertShipOnBoard(i,t){return i.positions.forEach(s=>{let r=t[s.x][s.y];r.setShip(),t[s.x][s.y]=r}),t}}let P=(()=>{class e{constructor(){}createShip(t){return l.createShip(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Y=d(135),z=d(579);let w=(()=>{class e{constructor(){this._gameboard=new Y.X(l.createGameBoard(0,[])),this._shots=0,this._playAgain=new z.x}playAgain(){this._playAgain.next()}playAgainEvent(){return this._playAgain}getShots(){return this._shots}setShots(t){this._shots=t}getGameboard(){return this._gameboard}createGameboard(t,s){return l.createGameBoard(t,s)}loadGameboard(t){this._gameboard.next(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var _=(()=>{return(e=_||(_={})).DIMENSION="dimension",e.SHOTS="shots",_;var e})();let C=(()=>{class e{constructor(){}setLocal(t,s){let r=this.encrypt(s);localStorage.setItem(t,r)}setSession(t,s){if(a.debug(`${s}`),"string"==typeof s){let r=this.encrypt(s);sessionStorage.setItem(t,r)}}getLocal(t){let s=localStorage.getItem(t)||"";return this.decrypt(s)}getSession(t){a.debug(`${t}`);let s=sessionStorage.getItem(t)||"";return this.decrypt(s)}clearLocal(){localStorage.clear()}clearSession(){sessionStorage.clear()}encrypt(t){return btoa(t)}decrypt(t){return atob(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),B=(()=>{class e extends m{constructor(t){super(),this.storageService=t}getShots(){let t=this.storageService.getSession(_.SHOTS),s=0;try{s=JSON.parse(t)}catch(r){this.throwError("Error al tratar de transformar los tiros.")}return s}}return e.\u0275fac=function(t){return new(t||e)(o.LFG(C))},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),$=(()=>{class e{constructor(t,s,r){this.shipService=t,this.gameboardService=s,this.shotsService=r}ngOnInit(){this.listenPlayAgain()}listenPlayAgain(){this.gameboardService.playAgainEvent().subscribe(()=>{this.buildGame()})}buildGame(){a.debug("building..."),a.debug("creating ships...");let t=this.createShips();a.debug("creating gameboard...");let s=this.createGameboard(f.N.dimension,t),r=this.getShots();a.debug(`getting shots ${r}`),a.debug("load gameboard..."),this.gameboardService.setShots(r),this.gameboardService.loadGameboard(s)}createShips(){return[this.shipService.createShip(4),this.shipService.createShip(3),this.shipService.createShip(3),this.shipService.createShip(2),this.shipService.createShip(2),this.shipService.createShip(2),this.shipService.createShip(1),this.shipService.createShip(1),this.shipService.createShip(1),this.shipService.createShip(1)]}createGameboard(t,s){return this.gameboardService.createGameboard(t,s)}getShots(){return this.shotsService.getShots()}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(P),o.Y36(w),o.Y36(B))},e.\u0275cmp=o.Xpm({type:e,selectors:[["bts-battleship"]],decls:2,vars:0,consts:[[1,"p-12"]],template:function(t,s){1&t&&(o.TgZ(0,"div",0),o._UZ(1,"router-outlet"),o.qZA())},directives:[b.lC],styles:[""]}),e})();const j=function(e){return["gameboard__cell",e]};function D(e,i){if(1&e){const t=o.EpF();o.TgZ(0,"li",11),o.NdJ("click",function(){const n=o.CHM(t).index,g=o.oxw().index;return o.oxw(2).fireShot(g,n)}),o.qZA()}2&e&&o.Q6J("ngClass",o.VKq(1,j,"gameboard__cell--"+i.$implicit.state))}function q(e,i){if(1&e&&(o.TgZ(0,"ul",9),o.YNc(1,D,1,3,"li",10),o.qZA()),2&e){const t=i.$implicit;o.xp6(1),o.Q6J("ngForOf",t)}}function H(e,i){if(1&e&&(o.TgZ(0,"section",7),o.YNc(1,q,2,1,"ul",8),o.qZA()),2&e){const t=o.oxw();o.xp6(1),o.Q6J("ngForOf",t.getBoard())}}function Q(e,i){if(1&e&&(o.TgZ(0,"div",12)(1,"div",13)(2,"p"),o._uU(3),o.qZA(),o.TgZ(4,"p"),o._uU(5),o.qZA(),o.TgZ(6,"p"),o._uU(7),o.qZA(),o.TgZ(8,"p"),o._uU(9),o.qZA()()()),2&e){const t=o.oxw();o.xp6(3),o.hij("Dimension: ",t.gameboard.dimension,""),o.xp6(2),o.hij("Barcos: ",t.gameboard.ships.length,""),o.xp6(2),o.hij("Barcos hundidos: ",t.shipsDestroyed,""),o.xp6(2),o.hij("Turnos: ",t.shots<0?"infinitos":t.shots,"")}}function X(e,i){if(1&e){const t=o.EpF();o.TgZ(0,"div",14)(1,"p",15),o._uU(2,"Game Over"),o.qZA(),o.TgZ(3,"button",16),o.NdJ("click",function(){return o.CHM(t),o.oxw().restart()}),o._uU(4," Intentar de nuevo "),o.qZA()()}}let W=(()=>{class e{constructor(t,s){this.gameboardService=t,this.router=s,this._shots=-1,this._shipsDestroyed=0}get shipsDestroyed(){return this._shipsDestroyed}get canPlay(){return 0!==this.shots}get gameboard(){return this._gameboard}get shots(){return this._shots}ngOnInit(){this.listenGameboardChanges(),this.restart()}restart(){this.gameboardService.playAgain()}back(){this.router.navigate(["battleship/menu"])}listenGameboardChanges(){this.gameboardService.getGameboard().subscribe(t=>{a.debug(`gameboard are loaded with dimension ${t.dimension}`),this.getShots(),a.debug(`${this._shots}`),this.setGameboard(t)})}getShots(){let t=this.gameboardService.getShots();this.setShots(t)}setShots(t){this._shots=t}setGameboard(t){this._gameboard=t}fireShot(t,s){if(!this.canPlay)return;let r=this.getCell(t,s);if(r.state===p.CLEAN&&(this.decreaseShot(),a.debug(`fireShot is emitted on (${t},${s}) position`),r.setState(p.FAIL),r.isShip)){a.debug("this cell contain a ship: +1 hit");let n=this.findShip(t,s);n&&n.hit(),r.setState(p.HIT),(null==n?void 0:n.isDestroyed)&&(a.debug("this ship has been destroyed."),this.destroyShip(n))}}destroyShip(t){t.positions.forEach(({x:s,y:r})=>{this.getCell(s,r).setState(p.DESTROYED)}),this._shipsDestroyed++}findShip(t,s){let r=JSON.stringify({x:t,y:s});return this.getShips().find(n=>n.positions.join().includes(r))}getCell(t,s){return this.getBoard()[t][s]}getBoard(){return this._gameboard.board}getShips(){return this._gameboard.ships}decreaseShot(){this._shots--}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(w),o.Y36(b.F0))},e.\u0275cmp=o.Xpm({type:e,selectors:[["bts-gameboard"]],decls:8,vars:3,consts:[[1,"grid","grid-rows-3","grid-flow-col","gap-4","mx-auto","bg-white","rounded-xl","shadow-lg","items-center","p-6"],["class","gameboard row-span-3",4,"ngIf"],[1,"col-span-2","row-span-1"],["class","text-center flex-auto text-2xl",4,"ngIf"],["class","text-center flex-auto",4,"ngIf"],[1,"relative","h-full","row-span-2","col-span-2"],["type","button",1,"absolute","bottom-0","right-0","bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"],[1,"gameboard","row-span-3"],["class","gameboard__row",4,"ngFor","ngForOf"],[1,"gameboard__row"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"],[1,"text-center","flex-auto","text-2xl"],[1,"text-left"],[1,"text-center","flex-auto"],[1,"mb-6","text-3xl","text-bold"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"]],template:function(t,s){1&t&&(o.TgZ(0,"main",0),o.YNc(1,H,2,1,"section",1),o.TgZ(2,"section",2),o.YNc(3,Q,10,4,"div",3),o.YNc(4,X,5,0,"div",4),o.qZA(),o.TgZ(5,"section",5)(6,"button",6),o.NdJ("click",function(){return s.back()}),o._uU(7," Volver "),o.qZA()()()),2&t&&(o.xp6(1),o.Q6J("ngIf",s.gameboard),o.xp6(2),o.Q6J("ngIf",s.canPlay&&s.gameboard),o.xp6(1),o.Q6J("ngIf",!s.canPlay))},directives:[u.O5,u.sg,u.mk],styles:["[_nghost-%COMP%]   .gameboard[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .gameboard__row[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .gameboard__cell[_ngcontent-%COMP%]{background-color:#d6f8b8;border:1px solid #74BEC1;width:48px;height:48px}[_nghost-%COMP%]   .gameboard__cell--clean[_ngcontent-%COMP%]:hover{background-color:#74bec1}[_nghost-%COMP%]   .gameboard__cell--hit[_ngcontent-%COMP%]{background-color:#f8b195}[_nghost-%COMP%]   .gameboard__cell--fail[_ngcontent-%COMP%]{background-color:#6b7b8e}[_nghost-%COMP%]   .gameboard__cell--destroyed[_ngcontent-%COMP%]{background-color:#f67280}"]}),e})();var h=d(382);function V(e,i){1&e&&(o.TgZ(0,"p",11),o._uU(1,"Ingresa un valor de turnos valido."),o.qZA())}const K=[{path:"",redirectTo:"battleship/menu"},{path:"battleship",component:$,children:[{path:"menu",component:(()=>{class e{constructor(t,s){this.storageService=t,this.router=s,this.shots=new h.NI(0,[h.kI.required,h.kI.min(0)])}ngOnInit(){}play(){let t=this.shots.value,s=Number(t);if(this.shots.valid&&s>0)return a.debug(`valid number of shots ${t}`),this.playGame(t);this.shots.setErrors({})}playEasy(){this.playGame("-1")}playMedium(){this.playGame("100")}playHard(){this.playGame("50")}playGame(t){this.saveShots(t),this.goToGameboard()}saveShots(t){this.storageService.setSession(_.SHOTS,t)}goToGameboard(){this.router.navigate(["battleship/gameboard"])}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(C),o.Y36(b.F0))},e.\u0275cmp=o.Xpm({type:e,selectors:[["bts-menu"]],decls:18,vars:2,consts:[[1,"text-center","items-center","max-w-xs","mx-auto","bg-white","rounded-xl","shadow-lg","p-6"],[1,"mb-4","text-left"],["for","turnos",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["id","shots","type","text","oninput","this.value = Math.round(this.value);","placeholder","numero de turnos",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"formControl"],["class","text-red-500 text-xs italic mt-2",4,"ngIf"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"],[1,"mt-12"],[1,"flex","flex-col"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","rounded","focus:outline-none","focus:shadow-outline","mt-6","ml-6","mr-6",3,"click"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","rounded","focus:outline-none","focus:shadow-outline","m-6",3,"click"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","rounded","focus:outline-none","focus:shadow-outline","ml-6","mr-6",3,"click"],[1,"text-red-500","text-xs","italic","mt-2"]],template:function(t,s){1&t&&(o.TgZ(0,"form",0)(1,"div",1)(2,"label",2),o._uU(3," Ingrese el numero de turnos "),o.qZA(),o._UZ(4,"input",3),o.YNc(5,V,2,0,"p",4),o.qZA(),o.TgZ(6,"button",5),o.NdJ("click",function(){return s.play()}),o._uU(7," Iniciar juego "),o.qZA(),o.TgZ(8,"section",6)(9,"p"),o._uU(10,"Tambien puede elegir entre estos 3 niveles"),o.qZA(),o.TgZ(11,"div",7)(12,"button",8),o.NdJ("click",function(){return s.playEasy()}),o._uU(13," Facil "),o.qZA(),o.TgZ(14,"button",9),o.NdJ("click",function(){return s.playMedium()}),o._uU(15," Medio "),o.qZA(),o.TgZ(16,"button",10),o.NdJ("click",function(){return s.playHard()}),o._uU(17," Dificil "),o.qZA()()()()),2&t&&(o.xp6(4),o.Q6J("formControl",s.shots),o.xp6(1),o.Q6J("ngIf",s.shots.invalid))},directives:[h._Y,h.JL,h.F,h.Fj,h.JJ,h.oH,u.O5],styles:[""]}),e})()},{path:"gameboard",component:W}]}];let tt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[b.Bz.forChild(K)],b.Bz]}),e})(),et=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({providers:[w],imports:[[u.ez]]}),e})(),ot=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({providers:[P],imports:[[u.ez]]}),e})(),it=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({providers:[C],imports:[[u.ez]]}),e})(),st=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[u.ez,it,h.UX,h.u5]]}),e})(),rt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({providers:[B],imports:[[u.ez]]}),e})(),nt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[u.ez,tt,et,ot,st,rt]]}),e})()}}]);