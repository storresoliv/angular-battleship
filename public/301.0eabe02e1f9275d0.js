"use strict";(self.webpackChunkbattleship=self.webpackChunkbattleship||[]).push([[301],{301:(lt,T,d)=>{d.r(T),d.d(T,{BattleshipModule:()=>at});var u=d(808),b=d(342),f=d(340);class a{static error(s){f.N.logLevel>0&&console.error(`:::LOGGER:::ERROR:: ${s}`)}static warn(s){f.N.logLevel>1&&console.warn(`:::LOGGER:::WARN:: ${s}`)}static info(s){f.N.logLevel>2&&console.log(`:::LOGGER:::INFO:: ${s}`)}static debug(s){f.N.logLevel>3&&console.log(`:::LOGGER:::DEBUG:: ${s}`)}}var o=d(223),p=(()=>{return(e=p||(p={})).CLEAN="clean",e.HIT="hit",e.DESTROYED="destroyed",e.FAIL="fail",p;var e})(),c=(()=>{return(e=c||(c={})).RIGHT="right",e.LEFT="left",e.UP="up",e.DOWN="down",c;var e})();class g{toString(){let s="";try{s=JSON.stringify(this)}catch(t){this.throwError(`error to try transform ${this.constructor.name} to string`)}return s}throwError(s){throw new Error(`[${this.constructor.name}]: ${s}`)}}class N extends g{constructor(s){super(),this._position=s,this._state=p.CLEAN,this._isShip=!1}get isShip(){return this._isShip}get state(){return this._state}get position(){return this._position}setState(s){this._state=s}setShip(){this._isShip=!0}}class F extends g{constructor(s,t){super(),this.x=s,this.y=t}}class J extends g{constructor(s=0){super(),this._positions=[],this._size=s,this._hits=0}get size(){return this._size?this._size:this._positions.length}get positions(){return this._positions}get hits(){return this._hits}get isDestroyed(){return this._hits===this.size}build(s){0===s.length&&this.throwError("positions can not be empty."),this._size>0&&this._size!==s.length&&this.throwError(`positions length should be ${this._size} instead ${s.length}`),this._positions.length>0&&this.throwError("this ship is already builded."),this._positions=s}hit(){this._hits++}}class L extends g{constructor(s){super(),this._position=s}get position(){return this._position}}class l{static createPosition(s,t){return new F(s,t)}static createShip(s){return new J(s)}static createShot(s){return new L(s)}static createCellBoard(s){return new N(s)}static createGameBoard(s,t){return new R(s,t)}static addPosition(s,t){let i;switch(t){case c.RIGHT:i=l.createPosition(s.x+1,s.y);break;case c.LEFT:i=l.createPosition(s.x-1,s.y);break;case c.UP:i=l.createPosition(s.x,s.y+1);break;case c.DOWN:i=l.createPosition(s.x,s.y-1);break;default:i=s}return i}}const v=e=>{let s=Math.floor(Math.random()*e)-1;return s>=0?s:0},x=[c.RIGHT,c.LEFT,c.DOWN,c.UP];class R extends g{constructor(s,t){super(),this._dimension=s,this._unBuildedShips=t,this._board=[],this._ships=[],this.build()}get dimension(){return this._dimension}get board(){return this._board}get ships(){return this._ships}build(){this._board=this.createGameBoard(),this.buildShips(this._board)}createGameBoard(){let s,t=[];for(let i=0;i<this._dimension;i++){s=[];for(let r=0;r<this._dimension;r++){let n=l.createPosition(i,r),m=l.createCellBoard(n);s.push(m)}t.push(s)}return t}buildShips(s){const t=i=>{let r=this.createShipPositions(i.size,s);return i.build(r),s=this.insertShipOnBoard(i,s),i};this._ships=this._unBuildedShips.map(i=>t(i))}createShipPositions(s,t){return 1===s?[this.createEmptyPosition(t)]:this.findPositions(s,t)}findPositions(s,t,i=0){1e3===i&&this.throwError("can create position for this ship."),i++;let k,S,r=this.createEmptyPosition(t),n=[r],m=r,O=s,A=x.length,E=0,y=v(x.length),G=1,M=!1,Z=!1;for(;!M;){let I=!1;k=x[y],S=l.addPosition(m,k),m.toString()!==S.toString()&&(I=this.isEmptyPosition(S,t)),I?(m=S,n.push(S),G++):(n=[r],m=r,G=1,E++,y++),y>A&&(y=0),E===A&&(Z=!0,M=!0),G===O&&(M=!0)}return Z?this.findPositions(s,t,i):n}createEmptyPosition(s){let t=this.createRandomPosition();return this.isEmptyPosition(t,s)?t:this.createEmptyPosition(s)}createRandomPosition(){let s=v(this._dimension),t=v(this._dimension);return l.createPosition(s,t)}isEmptyPosition(s,t){try{let i=t[s.x][s.y],{isShip:r}=i;return!r}catch(i){return!1}}insertShipOnBoard(s,t){return s.positions.forEach(i=>{let r=t[i.x][i.y];r.setShip(),t[i.x][i.y]=r}),t}}let B=(()=>{class e{constructor(){}createShip(t){return l.createShip(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Y=d(135),z=d(579);let w=(()=>{class e{constructor(){this._gameboard=new Y.X(l.createGameBoard(0,[])),this._shots=0,this._playAgain=new z.x}playAgain(){this._playAgain.next()}playAgainEvent(){return this._playAgain}getShots(){return this._shots}setShots(t){this._shots=t}getGameboard(){return this._gameboard}createGameboard(t,i){return l.createGameBoard(t,i)}loadGameboard(t){this._gameboard.next(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var _=(()=>{return(e=_||(_={})).DIMENSION="dimension",e.SHOTS="shots",_;var e})();let C=(()=>{class e{constructor(){}setLocal(t,i){let r=this.encrypt(i);localStorage.setItem(t,r)}setSession(t,i){if(a.debug(`${i}`),"string"==typeof i){let r=this.encrypt(i);sessionStorage.setItem(t,r)}}getLocal(t){let i=localStorage.getItem(t)||"";return this.decrypt(i)}getSession(t){a.debug(`${t}`);let i=sessionStorage.getItem(t)||"";return this.decrypt(i)}clearLocal(){localStorage.clear()}clearSession(){sessionStorage.clear()}encrypt(t){return btoa(t)}decrypt(t){return atob(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),P=(()=>{class e extends g{constructor(t){super(),this.storageService=t}getShots(){let t=this.storageService.getSession(_.SHOTS),i=0;try{i=JSON.parse(t)}catch(r){this.throwError("Error al tratar de transformar los tiros.")}return i}}return e.\u0275fac=function(t){return new(t||e)(o.LFG(C))},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),$=(()=>{class e{constructor(t,i,r){this.shipService=t,this.gameboardService=i,this.shotsService=r}ngOnInit(){this.listenPlayAgain()}listenPlayAgain(){this.gameboardService.playAgainEvent().subscribe(()=>{this.buildGame()})}buildGame(){a.debug("building..."),a.debug("creating ships...");let t=this.createShips();a.debug("creating gameboard...");let i=this.createGameboard(f.N.dimension,t),r=this.getShots();a.debug(`getting shots ${r}`),a.debug("load gameboard..."),this.gameboardService.setShots(r),this.gameboardService.loadGameboard(i)}createShips(){return[this.shipService.createShip(4),this.shipService.createShip(3),this.shipService.createShip(3),this.shipService.createShip(2),this.shipService.createShip(2),this.shipService.createShip(2),this.shipService.createShip(1),this.shipService.createShip(1),this.shipService.createShip(1),this.shipService.createShip(1)]}createGameboard(t,i){return this.gameboardService.createGameboard(t,i)}getShots(){return this.shotsService.getShots()}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(B),o.Y36(w),o.Y36(P))},e.\u0275cmp=o.Xpm({type:e,selectors:[["bts-battleship"]],decls:1,vars:0,template:function(t,i){1&t&&o._UZ(0,"router-outlet")},directives:[b.lC],styles:[""]}),e})();const D=function(e){return["gameboard__cell h-4 w-4 sxx:h-6 sxx:w-6 sx:h-8 sx:w-8 sm:h-10 sm:w-10 md:h-12 md:w-12 xl:h-20 xl:w-20",e]};function q(e,s){if(1&e){const t=o.EpF();o.TgZ(0,"li",12),o.NdJ("click",function(){const n=o.CHM(t).index,m=o.oxw().index;return o.oxw(2).fireShot(m,n)}),o.qZA()}2&e&&o.Q6J("ngClass",o.VKq(1,D,"gameboard__cell--"+s.$implicit.state))}function H(e,s){if(1&e&&(o.TgZ(0,"ul",10),o.YNc(1,q,1,3,"li",11),o.qZA()),2&e){const t=s.$implicit;o.xp6(1),o.Q6J("ngForOf",t)}}function Q(e,s){if(1&e&&(o.TgZ(0,"section",8),o.YNc(1,H,2,1,"ul",9),o.qZA()),2&e){const t=o.oxw();o.xp6(1),o.Q6J("ngForOf",t.getBoard())}}function X(e,s){if(1&e&&(o.TgZ(0,"div",13)(1,"div",14)(2,"p"),o._uU(3),o.qZA(),o.TgZ(4,"p"),o._uU(5),o.qZA(),o.TgZ(6,"p"),o._uU(7),o.qZA(),o.TgZ(8,"p"),o._uU(9),o.qZA()()()),2&e){const t=o.oxw();o.xp6(3),o.hij("Dimension: ",t.gameboard.dimension,""),o.xp6(2),o.hij("Barcos: ",t.gameboard.ships.length,""),o.xp6(2),o.hij("Barcos hundidos: ",t.shipsDestroyed,""),o.xp6(2),o.hij("Turnos: ",t.shots<0?"infinitos":t.shots,"")}}function W(e,s){if(1&e){const t=o.EpF();o.TgZ(0,"div",15)(1,"p",16),o._uU(2,"Game Over"),o.qZA(),o.TgZ(3,"button",17),o.NdJ("click",function(){return o.CHM(t),o.oxw().restart()}),o._uU(4," Intentar de nuevo "),o.qZA()()}}let V=(()=>{class e{constructor(t,i){this.gameboardService=t,this.router=i,this._shots=-1,this._shipsDestroyed=0}get shipsDestroyed(){return this._shipsDestroyed}get canPlay(){return 0!==this.shots}get gameboard(){return this._gameboard}get shots(){return this._shots}ngOnInit(){this.listenGameboardChanges(),this.restart()}restart(){this.gameboardService.playAgain()}back(){this.router.navigate(["battleship/menu"])}listenGameboardChanges(){this.gameboardService.getGameboard().subscribe(t=>{a.debug(`gameboard are loaded with dimension ${t.dimension}`),this.getShots(),a.debug(`${this._shots}`),this.setGameboard(t)})}getShots(){let t=this.gameboardService.getShots();this.setShots(t)}setShots(t){this._shots=t}setGameboard(t){this._gameboard=t}fireShot(t,i){if(!this.canPlay)return;let r=this.getCell(t,i);if(r.state===p.CLEAN&&(this.decreaseShot(),a.debug(`fireShot is emitted on (${t},${i}) position`),r.setState(p.FAIL),r.isShip)){a.debug("this cell contain a ship: +1 hit");let n=this.findShip(t,i);n&&n.hit(),r.setState(p.HIT),(null==n?void 0:n.isDestroyed)&&(a.debug("this ship has been destroyed."),this.destroyShip(n))}}destroyShip(t){t.positions.forEach(({x:i,y:r})=>{this.getCell(i,r).setState(p.DESTROYED)}),this._shipsDestroyed++}findShip(t,i){let r=JSON.stringify({x:t,y:i});return this.getShips().find(n=>n.positions.join().includes(r))}getCell(t,i){return this.getBoard()[t][i]}getBoard(){return this._gameboard.board}getShips(){return this._gameboard.ships}decreaseShot(){this._shots--}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(w),o.Y36(b.F0))},e.\u0275cmp=o.Xpm({type:e,selectors:[["bts-gameboard"]],decls:9,vars:3,consts:[[1,"md:h-12"],[1,"md:container","md:mx-auto","md:grid","md:grid-rows-3","md:grid-flow-col","md:gap-4","md:bg-white","md:rounded-xl","md:shadow-lg","items-center","p-3"],["class","w-full md:row-span-3 gameboard",4,"ngIf"],[1,"md:col-span-2","md:row-span-1","mb-4"],["class","text-center flex-auto text-2xl",4,"ngIf"],["class","text-center flex-auto",4,"ngIf"],[1,"md:relative","md:h-full","md:row-span-2","md:col-span-2","text-center"],["type","button",1,"md:absolute","bottom-0","right-0","bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"],[1,"w-full","md:row-span-3","gameboard"],["class","gameboard__row",4,"ngFor","ngForOf"],[1,"gameboard__row"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"],[1,"text-center","flex-auto","text-2xl"],[1,"text-left"],[1,"text-center","flex-auto"],[1,"mb-6","text-3xl","text-bold"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"]],template:function(t,i){1&t&&(o._UZ(0,"div",0),o.TgZ(1,"main",1),o.YNc(2,Q,2,1,"section",2),o.TgZ(3,"section",3),o.YNc(4,X,10,4,"div",4),o.YNc(5,W,5,0,"div",5),o.qZA(),o.TgZ(6,"section",6)(7,"button",7),o.NdJ("click",function(){return i.back()}),o._uU(8," Volver "),o.qZA()()()),2&t&&(o.xp6(2),o.Q6J("ngIf",i.gameboard),o.xp6(2),o.Q6J("ngIf",i.canPlay&&i.gameboard),o.xp6(1),o.Q6J("ngIf",!i.canPlay))},directives:[u.O5,u.sg,u.mk],styles:["[_nghost-%COMP%]   .gameboard__row[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .gameboard__cell[_ngcontent-%COMP%]{background-color:#d6f8b8;border:2px solid #74BEC1}[_nghost-%COMP%]   .gameboard__cell--clean[_ngcontent-%COMP%]:hover{background-color:#74bec1}[_nghost-%COMP%]   .gameboard__cell--hit[_ngcontent-%COMP%]{background-color:#f8b195}[_nghost-%COMP%]   .gameboard__cell--fail[_ngcontent-%COMP%]{background-color:#6b7b8e}[_nghost-%COMP%]   .gameboard__cell--destroyed[_ngcontent-%COMP%]{background-color:#f67280}"]}),e})();var h=d(382);function K(e,s){1&e&&(o.TgZ(0,"p",12),o._uU(1,"Ingresa un valor de turnos valido."),o.qZA())}const tt=[{path:"",redirectTo:"battleship/menu"},{path:"battleship",component:$,children:[{path:"menu",component:(()=>{class e{constructor(t,i){this.storageService=t,this.router=i,this.shots=new h.NI(0,[h.kI.required,h.kI.min(0)])}ngOnInit(){}play(){let t=this.shots.value,i=Number(t);if(this.shots.valid&&i>0)return a.debug(`valid number of shots ${t}`),this.playGame(t);this.shots.setErrors({})}playEasy(){this.playGame("-1")}playMedium(){this.playGame("100")}playHard(){this.playGame("50")}playGame(t){this.saveShots(t),this.goToGameboard()}saveShots(t){this.storageService.setSession(_.SHOTS,t)}goToGameboard(){this.router.navigate(["battleship/gameboard"])}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(C),o.Y36(b.F0))},e.\u0275cmp=o.Xpm({type:e,selectors:[["bts-menu"]],decls:19,vars:2,consts:[[1,"md:pt-12"],[1,"h-screen","md:h-fit","text-center","items-center","max-w-xs","mx-auto","bg-white","md:rounded-xl","md:shadow-lg","p-6"],[1,"mb-4","text-left"],["for","turnos",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["id","shots","type","text","oninput","this.value = Math.round(this.value);","placeholder","numero de turnos",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"formControl"],["class","text-red-500 text-xs italic mt-2",4,"ngIf"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"],[1,"mt-12"],[1,"flex","flex-col"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","rounded","focus:outline-none","focus:shadow-outline","mt-6","ml-6","mr-6",3,"click"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","rounded","focus:outline-none","focus:shadow-outline","m-6",3,"click"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","rounded","focus:outline-none","focus:shadow-outline","ml-6","mr-6",3,"click"],[1,"text-red-500","text-xs","italic","mt-2"]],template:function(t,i){1&t&&(o.TgZ(0,"main",0)(1,"form",1)(2,"div",2)(3,"label",3),o._uU(4," Ingrese el numero de turnos "),o.qZA(),o._UZ(5,"input",4),o.YNc(6,K,2,0,"p",5),o.qZA(),o.TgZ(7,"button",6),o.NdJ("click",function(){return i.play()}),o._uU(8," Iniciar juego "),o.qZA(),o.TgZ(9,"section",7)(10,"p"),o._uU(11,"Tambien puede elegir entre estos 3 niveles"),o.qZA(),o.TgZ(12,"div",8)(13,"button",9),o.NdJ("click",function(){return i.playEasy()}),o._uU(14," Facil "),o.qZA(),o.TgZ(15,"button",10),o.NdJ("click",function(){return i.playMedium()}),o._uU(16," Medio "),o.qZA(),o.TgZ(17,"button",11),o.NdJ("click",function(){return i.playHard()}),o._uU(18," Dificil "),o.qZA()()()()()),2&t&&(o.xp6(5),o.Q6J("formControl",i.shots),o.xp6(1),o.Q6J("ngIf",i.shots.invalid))},directives:[h._Y,h.JL,h.F,h.Fj,h.JJ,h.oH,u.O5],styles:[""]}),e})()},{path:"gameboard",component:V}]}];let et=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[b.Bz.forChild(tt)],b.Bz]}),e})(),ot=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({providers:[w],imports:[[u.ez]]}),e})(),st=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({providers:[B],imports:[[u.ez]]}),e})(),it=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({providers:[C],imports:[[u.ez]]}),e})(),rt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[u.ez,it,h.UX,h.u5]]}),e})(),nt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({providers:[P],imports:[[u.ez]]}),e})(),at=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[u.ez,et,ot,st,rt,nt]]}),e})()}}]);