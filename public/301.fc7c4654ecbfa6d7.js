"use strict";(self.webpackChunkbattleship=self.webpackChunkbattleship||[]).push([[301],{301:(ht,M,u)=>{u.r(M),u.d(M,{BattleshipModule:()=>lt});var d=u(808),b=u(342),_=u(340);class a{static error(s){_.N.logLevel>0&&console.error(`:::LOGGER:::ERROR:: ${s}`)}static warn(s){_.N.logLevel>1&&console.warn(`:::LOGGER:::WARN:: ${s}`)}static info(s){_.N.logLevel>2&&console.log(`:::LOGGER:::INFO:: ${s}`)}static debug(s){_.N.logLevel>3&&console.log(`:::LOGGER:::DEBUG:: ${s}`)}}var e=u(223),p=(()=>{return(o=p||(p={})).CLEAN="clean",o.HIT="hit",o.DESTROYED="destroyed",o.FAIL="fail",p;var o})(),l=(()=>{return(o=l||(l={})).RIGHT="right",o.LEFT="left",o.UP="up",o.DOWN="down",l;var o})();class g{toString(){let s="";try{s=JSON.stringify(this)}catch(t){this.throwError(`error to try transform ${this.constructor.name} to string`)}return s}throwError(s){throw new Error(`[${this.constructor.name}]: ${s}`)}}class N extends g{constructor(s){super(),this._position=s,this._state=p.CLEAN,this._isShip=!1}get isShip(){return this._isShip}get state(){return this._state}get position(){return this._position}setState(s){this._state=s}setShip(){this._isShip=!0}}class F extends g{constructor(s,t){super(),this.x=s,this.y=t}}class J extends g{constructor(s=0){super(),this._positions=[],this._size=s,this._hits=0}get size(){return this._size?this._size:this._positions.length}get positions(){return this._positions}get hits(){return this._hits}get isDestroyed(){return this._hits===this.size}build(s){0===s.length&&this.throwError("positions can not be empty."),this._size>0&&this._size!==s.length&&this.throwError(`positions length should be ${this._size} instead ${s.length}`),this._positions.length>0&&this.throwError("this ship is already builded."),this._positions=s}hit(){this._hits++}}class U extends g{constructor(s){super(),this._position=s}get position(){return this._position}}class c{static createPosition(s,t){return new F(s,t)}static createShip(s){return new J(s)}static createShot(s){return new U(s)}static createCellBoard(s){return new N(s)}static createGameBoard(s,t){return new L(s,t)}static addPosition(s,t){let i;switch(t){case l.RIGHT:i=c.createPosition(s.x+1,s.y);break;case l.LEFT:i=c.createPosition(s.x-1,s.y);break;case l.UP:i=c.createPosition(s.x,s.y+1);break;case l.DOWN:i=c.createPosition(s.x,s.y-1);break;default:i=s}return i}}const v=o=>{let s=Math.floor(Math.random()*o)-1;return s>=0?s:0},x=[l.RIGHT,l.LEFT,l.DOWN,l.UP];class L extends g{constructor(s,t){super(),this._dimension=s,this._unBuildedShips=t,this._board=[],this._ships=[],this.build()}get dimension(){return this._dimension}get board(){return this._board}get ships(){return this._ships}build(){this._board=this.createGameBoard(),this.buildShips(this._board)}createGameBoard(){let s,t=[];for(let i=0;i<this._dimension;i++){s=[];for(let r=0;r<this._dimension;r++){let n=c.createPosition(i,r),m=c.createCellBoard(n);s.push(m)}t.push(s)}return t}buildShips(s){const t=i=>{let r=this.createShipPositions(i.size,s);return i.build(r),s=this.insertShipOnBoard(i,s),i};this._ships=this._unBuildedShips.map(i=>t(i))}createShipPositions(s,t){return 1===s?[this.createEmptyPosition(t)]:this.findPositions(s,t)}findPositions(s,t,i=0){1e3===i&&this.throwError("can create position for this ship."),i++;let k,S,r=this.createEmptyPosition(t),n=[r],m=r,P=s,A=x.length,O=0,y=v(x.length),G=1,T=!1,E=!1;for(;!T;){let I=!1;k=x[y],S=c.addPosition(m,k),m.toString()!==S.toString()&&(I=this.isEmptyPosition(S,t)),I?(m=S,n.push(S),G++):(n=[r],m=r,G=1,O++,y++),y>A&&(y=0),O===A&&(E=!0,T=!0),G===P&&(T=!0)}return E?this.findPositions(s,t,i):n}createEmptyPosition(s){let t=this.createRandomPosition();return this.isEmptyPosition(t,s)?t:this.createEmptyPosition(s)}createRandomPosition(){let s=v(this._dimension),t=v(this._dimension);return c.createPosition(s,t)}isEmptyPosition(s,t){try{let i=t[s.x][s.y],{isShip:r}=i;return!r}catch(i){return!1}}insertShipOnBoard(s,t){return s.positions.forEach(i=>{let r=t[i.x][i.y];r.setShip(),t[i.x][i.y]=r}),t}}let B=(()=>{class o{constructor(){}createShip(t){return c.createShip(t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var D=u(135),R=u(579);let w=(()=>{class o{constructor(){this._gameboard=new D.X(c.createGameBoard(0,[])),this._shots=0,this._playAgain=new R.x}playAgain(){this._playAgain.next()}playAgainEvent(){return this._playAgain}getShots(){return this._shots}setShots(t){this._shots=t}getGameboard(){return this._gameboard}createGameboard(t,i){return c.createGameBoard(t,i)}loadGameboard(t){this._gameboard.next(t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var f=(()=>{return(o=f||(f={})).DIMENSION="dimension",o.SHOTS="shots",f;var o})();let C=(()=>{class o{constructor(){}setLocal(t,i){let r=this.encrypt(i);localStorage.setItem(t,r)}setSession(t,i){if(a.debug(`${i}`),"string"==typeof i){let r=this.encrypt(i);sessionStorage.setItem(t,r)}}getLocal(t){let i=localStorage.getItem(t)||"";return this.decrypt(i)}getSession(t){a.debug(`${t}`);let i=sessionStorage.getItem(t)||"";return this.decrypt(i)}clearLocal(){localStorage.clear()}clearSession(){sessionStorage.clear()}encrypt(t){return btoa(t)}decrypt(t){return atob(t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),Z=(()=>{class o extends g{constructor(t){super(),this.storageService=t}getShots(){let t=this.storageService.getSession(f.SHOTS),i=0;try{i=JSON.parse(t)}catch(r){this.throwError("Error al tratar de transformar los tiros.")}return i}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(C))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),z=(()=>{class o{constructor(t,i,r){this.shipService=t,this.gameboardService=i,this.shotsService=r}ngOnInit(){this.listenPlayAgain()}listenPlayAgain(){this.gameboardService.playAgainEvent().subscribe(()=>{this.buildGame()})}buildGame(){a.debug("building..."),a.debug("creating ships...");let t=this.createShips();a.debug("creating gameboard...");let i=this.createGameboard(_.N.dimension,t),r=this.getShots();a.debug(`getting shots ${r}`),a.debug("load gameboard..."),this.gameboardService.setShots(r),this.gameboardService.loadGameboard(i)}createShips(){return[this.shipService.createShip(4),this.shipService.createShip(3),this.shipService.createShip(3),this.shipService.createShip(2),this.shipService.createShip(2),this.shipService.createShip(2),this.shipService.createShip(1),this.shipService.createShip(1),this.shipService.createShip(1),this.shipService.createShip(1)]}createGameboard(t,i){return this.gameboardService.createGameboard(t,i)}getShots(){return this.shotsService.getShots()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(B),e.Y36(w),e.Y36(Z))},o.\u0275cmp=e.Xpm({type:o,selectors:[["bts-battleship"]],decls:1,vars:0,template:function(t,i){1&t&&e._UZ(0,"router-outlet")},directives:[b.lC],styles:[""]}),o})();const j=function(o){return["gameboard__cell h-4 w-4 sxx:h-6 sxx:w-6 sx:h-8 sx:w-8 sm:h-10 sm:w-10 md:h-12 md:w-12 xl:h-20 xl:w-20",o]};function q(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"li",12),e.NdJ("click",function(){const n=e.CHM(t).index,m=e.oxw().index;return e.oxw(2).fireShot(m,n)}),e.qZA()}2&o&&e.Q6J("ngClass",e.VKq(1,j,"gameboard__cell--"+s.$implicit.state))}function H(o,s){if(1&o&&(e.TgZ(0,"ul",10),e.YNc(1,q,1,3,"li",11),e.qZA()),2&o){const t=s.$implicit;e.xp6(1),e.Q6J("ngForOf",t)}}function Q(o,s){if(1&o&&(e.TgZ(0,"section",8),e.YNc(1,H,2,1,"ul",9),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.getBoard())}}function W(o,s){if(1&o&&(e.TgZ(0,"div",13)(1,"div",14)(2,"p"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.qZA(),e.TgZ(6,"p"),e._uU(7),e.qZA(),e.TgZ(8,"p"),e._uU(9),e.qZA()()()),2&o){const t=e.oxw();e.xp6(3),e.hij("Dimension: ",t.gameboard.dimension,""),e.xp6(2),e.hij("Barcos: ",t.gameboard.ships.length,""),e.xp6(2),e.hij("Barcos hundidos: ",t.shipsDestroyed,""),e.xp6(2),e.hij("Turnos: ",t.shots<0?"infinitos":t.shots,"")}}function X(o,s){1&o&&(e.TgZ(0,"p",18),e._uU(1,"Felicidades has ganado."),e.qZA())}function V(o,s){1&o&&(e.TgZ(0,"p",18),e._uU(1,"Game Over"),e.qZA())}function K(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",15),e.YNc(1,X,2,0,"p",16),e.YNc(2,V,2,0,"p",16),e.TgZ(3,"button",17),e.NdJ("click",function(){return e.CHM(t),e.oxw().restart()}),e._uU(4," Intentar de nuevo "),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.isWin),e.xp6(1),e.Q6J("ngIf",!t.isWin)}}let tt=(()=>{class o{constructor(t,i){this.gameboardService=t,this.router=i,this._shots=-1,this._shipsDestroyed=0,this._isWin=!1}get shipsDestroyed(){return this._shipsDestroyed}get canPlay(){return this._shipsDestroyed===this.getShips().length&&this._shipsDestroyed>0?(this._isWin=!0,!1):0!==this.shots}get isWin(){return this._isWin}get gameboard(){return this._gameboard}get shots(){return this._shots}ngOnInit(){this.listenGameboardChanges(),this.restart()}restart(){this.gameboardService.playAgain()}back(){this.router.navigate(["battleship/menu"])}resetShipsDestroyed(){this._shipsDestroyed=0}listenGameboardChanges(){this.gameboardService.getGameboard().subscribe(t=>{a.debug(`gameboard are loaded with dimension ${t.dimension}`),this.getShots(),a.debug(`${this._shots}`),this.resetShipsDestroyed(),this.setGameboard(t)})}getShots(){let t=this.gameboardService.getShots();this.setShots(t)}setShots(t){this._shots=t}setGameboard(t){this._gameboard=t}fireShot(t,i){if(!this.canPlay)return;let r=this.getCell(t,i);if(r.state===p.CLEAN&&(this.decreaseShot(),a.debug(`fireShot is emitted on (${t},${i}) position`),r.setState(p.FAIL),r.isShip)){a.debug("this cell contain a ship: +1 hit");let n=this.findShip(t,i);n&&n.hit(),r.setState(p.HIT),(null==n?void 0:n.isDestroyed)&&(a.debug("this ship has been destroyed."),this.destroyShip(n))}}destroyShip(t){t.positions.forEach(({x:i,y:r})=>{this.getCell(i,r).setState(p.DESTROYED)}),this._shipsDestroyed++}findShip(t,i){let r=JSON.stringify({x:t,y:i});return this.getShips().find(n=>n.positions.join().includes(r))}getCell(t,i){return this.getBoard()[t][i]}getBoard(){return this._gameboard.board}getShips(){return this._gameboard.ships}decreaseShot(){this._shots--}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(w),e.Y36(b.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["bts-gameboard"]],decls:9,vars:3,consts:[[1,"md:h-12"],[1,"md:container","md:mx-auto","md:grid","md:grid-rows-3","md:grid-flow-col","md:gap-4","md:bg-white","md:rounded-xl","md:shadow-lg","items-center","p-3"],["class","w-full md:row-span-3 gameboard",4,"ngIf"],[1,"md:col-span-2","md:row-span-1","mb-4"],["class","text-center flex-auto text-2xl",4,"ngIf"],["class","text-center flex-auto",4,"ngIf"],[1,"md:relative","md:h-full","md:row-span-2","md:col-span-2","text-center"],["type","button",1,"md:absolute","bottom-0","right-0","bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"],[1,"w-full","md:row-span-3","gameboard"],["class","gameboard__row",4,"ngFor","ngForOf"],[1,"gameboard__row"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"],[1,"text-center","flex-auto","text-2xl"],[1,"text-left"],[1,"text-center","flex-auto"],["class","mb-6 text-3xl text-bold",4,"ngIf"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"],[1,"mb-6","text-3xl","text-bold"]],template:function(t,i){1&t&&(e._UZ(0,"div",0),e.TgZ(1,"main",1),e.YNc(2,Q,2,1,"section",2),e.TgZ(3,"section",3),e.YNc(4,W,10,4,"div",4),e.YNc(5,K,5,2,"div",5),e.qZA(),e.TgZ(6,"section",6)(7,"button",7),e.NdJ("click",function(){return i.back()}),e._uU(8," Volver "),e.qZA()()()),2&t&&(e.xp6(2),e.Q6J("ngIf",i.gameboard),e.xp6(2),e.Q6J("ngIf",i.canPlay&&i.gameboard),e.xp6(1),e.Q6J("ngIf",!i.canPlay))},directives:[d.O5,d.sg,d.mk],styles:["[_nghost-%COMP%]   .gameboard__row[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .gameboard__cell[_ngcontent-%COMP%]{background-color:#d6f8b8;border:2px solid #74BEC1}[_nghost-%COMP%]   .gameboard__cell--clean[_ngcontent-%COMP%]:hover{background-color:#74bec1}[_nghost-%COMP%]   .gameboard__cell--hit[_ngcontent-%COMP%]{background-color:#f8b195}[_nghost-%COMP%]   .gameboard__cell--fail[_ngcontent-%COMP%]{background-color:#6b7b8e}[_nghost-%COMP%]   .gameboard__cell--destroyed[_ngcontent-%COMP%]{background-color:#f67280}"]}),o})();var h=u(382);function et(o,s){1&o&&(e.TgZ(0,"p",10),e._uU(1,"Ingresa un valor de turnos valido."),e.qZA())}const ot=[{path:"",redirectTo:"battleship/menu"},{path:"battleship",component:z,children:[{path:"menu",component:(()=>{class o{constructor(t,i){this.storageService=t,this.router=i,this.shots=new h.NI(0,[h.kI.required,h.kI.min(0)])}ngOnInit(){}play(){let t=this.shots.value,i=Number(t);if(this.shots.valid&&i>0)return a.debug(`valid number of shots ${t}`),this.playGame(t);this.shots.setErrors({})}playEasy(){this.playGame("-1")}playMedium(){this.playGame("100")}playHard(){this.playGame("50")}playGame(t){this.saveShots(t),this.goToGameboard()}saveShots(t){this.storageService.setSession(f.SHOTS,t)}goToGameboard(){this.router.navigate(["battleship/gameboard"])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C),e.Y36(b.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["bts-menu"]],decls:19,vars:2,consts:[[1,"md:pt-12"],[1,"h-screen","md:h-fit","text-center","items-center","max-w-xs","mx-auto","bg-white","md:rounded-xl","md:shadow-lg","p-6"],[1,"mb-4","text-left"],["for","turnos",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["id","shots","type","text","oninput","this.value = Math.round(this.value);","placeholder","numero de turnos",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"formControl"],["class","text-red-500 text-xs italic mt-2",4,"ngIf"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"],[1,"mt-12"],[1,"flex","flex-col"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","rounded","focus:outline-none","focus:shadow-outline","mt-6",3,"click"],[1,"text-red-500","text-xs","italic","mt-2"]],template:function(t,i){1&t&&(e.TgZ(0,"main",0)(1,"form",1)(2,"div",2)(3,"label",3),e._uU(4," Ingrese el numero de turnos "),e.qZA(),e._UZ(5,"input",4),e.YNc(6,et,2,0,"p",5),e.qZA(),e.TgZ(7,"button",6),e.NdJ("click",function(){return i.play()}),e._uU(8," Iniciar juego "),e.qZA(),e.TgZ(9,"section",7)(10,"p"),e._uU(11,"Tambien puede elegir entre estos 3 niveles"),e.qZA(),e.TgZ(12,"div",8)(13,"button",9),e.NdJ("click",function(){return i.playEasy()}),e._uU(14," Facil "),e.qZA(),e.TgZ(15,"button",9),e.NdJ("click",function(){return i.playMedium()}),e._uU(16," Medio "),e.qZA(),e.TgZ(17,"button",9),e.NdJ("click",function(){return i.playHard()}),e._uU(18," Dificil "),e.qZA()()()()()),2&t&&(e.xp6(5),e.Q6J("formControl",i.shots),e.xp6(1),e.Q6J("ngIf",i.shots.invalid))},directives:[h._Y,h.JL,h.F,h.Fj,h.JJ,h.oH,d.O5],styles:[""]}),o})()},{path:"gameboard",component:tt}]}];let st=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[b.Bz.forChild(ot)],b.Bz]}),o})(),it=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[w],imports:[[d.ez]]}),o})(),rt=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[B],imports:[[d.ez]]}),o})(),nt=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[C],imports:[[d.ez]]}),o})(),at=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[d.ez,nt,h.UX,h.u5]]}),o})(),ct=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[Z],imports:[[d.ez]]}),o})(),lt=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[d.ez,st,it,rt,at,ct]]}),o})()}}]);