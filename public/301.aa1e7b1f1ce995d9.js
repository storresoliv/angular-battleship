"use strict";(self.webpackChunkbattleship=self.webpackChunkbattleship||[]).push([[301],{301:(at,P,u)=>{u.r(P),u.d(P,{BattleshipModule:()=>nt});var d=u(808),_=u(342),b=u(340);class a{static error(o){b.N.logLevel>0&&console.error(`:::LOGGER:::ERROR:: ${o}`)}static warn(o){b.N.logLevel>1&&console.warn(`:::LOGGER:::WARN:: ${o}`)}static info(o){b.N.logLevel>2&&console.log(`:::LOGGER:::INFO:: ${o}`)}static debug(o){b.N.logLevel>3&&console.log(`:::LOGGER:::DEBUG:: ${o}`)}}var s=u(223),p=(()=>{return(e=p||(p={})).CLEAN="clean",e.HIT="hit",e.DESTROYED="destroyed",e.FAIL="fail",p;var e})(),h=(()=>{return(e=h||(h={})).RIGHT="right",e.LEFT="left",e.UP="up",e.DOWN="down",h;var e})();class m{toString(){let o="";try{o=JSON.stringify(this)}catch(t){this.throwError(`error to try transform ${this.constructor.name} to string`)}return o}throwError(o){throw new Error(`[${this.constructor.name}]: ${o}`)}}class N extends m{constructor(o){super(),this._position=o,this._state=p.CLEAN,this._isShip=!1}get isShip(){return this._isShip}get state(){return this._state}get position(){return this._position}setState(o){this._state=o}setShip(){this._isShip=!0}}class k extends m{constructor(o,t){super(),this.x=o,this.y=t}}class J extends m{constructor(o=0){super(),this._positions=[],this._size=o,this._hits=0}get size(){return this._size?this._size:this._positions.length}get positions(){return this._positions}get hits(){return this._hits}get isDestroyed(){return this._hits===this.size}build(o){0===o.length&&this.throwError("positions can not be empty."),this._size>0&&this._size!==o.length&&this.throwError(`positions length should be ${this._size} instead ${o.length}`),this._positions.length>0&&this.throwError("this ship is already builded."),this._positions=o}hit(){this._hits++}}class L extends m{constructor(o){super(),this._position=o}get position(){return this._position}}class c{static createPosition(o,t){return new k(o,t)}static createShip(o){return new J(o)}static createShot(o){return new L(o)}static createCellBoard(o){return new N(o)}static createGameBoard(o,t){return new z(o,t)}static addPosition(o,t){let i;switch(t){case h.RIGHT:i=c.createPosition(o.x+1,o.y);break;case h.LEFT:i=c.createPosition(o.x-1,o.y);break;case h.UP:i=c.createPosition(o.x,o.y+1);break;case h.DOWN:i=c.createPosition(o.x,o.y-1);break;default:i=o}return i}}const v=e=>{let o=Math.floor(Math.random()*e)-1;return o>=0?o:0},x=[h.RIGHT,h.LEFT,h.DOWN,h.UP];class z extends m{constructor(o,t){super(),this._dimension=o,this._unBuildedShips=t,this._board=[],this._ships=[],this.build()}get dimension(){return this._dimension}get board(){return this._board}get ships(){return this._ships}build(){this._board=this.createGameBoard(),this.buildShips(this._board)}createGameBoard(){let o,t=[];for(let i=0;i<this._dimension;i++){o=[];for(let r=0;r<this._dimension;r++){let n=c.createPosition(i,r),g=c.createCellBoard(n);o.push(g)}t.push(o)}return t}buildShips(o){const t=i=>{let r=this.createShipPositions(i.size,o);return i.build(r),o=this.insertShipOnBoard(i,o),i};this._ships=this._unBuildedShips.map(i=>t(i))}createShipPositions(o,t){return 1===o?[this.createEmptyPosition(t)]:this.findPositions(o,t)}findPositions(o,t,i=0){1e3===i&&this.throwError("can create position for this ship."),i++;let Z,f,r=this.createEmptyPosition(t),n=[r],g=r,T=o,E=x.length,A=0,y=v(x.length),G=1,M=!1,I=!1;for(;!M;){let F=!1;Z=x[y],f=c.addPosition(g,Z),g.toString()!==f.toString()&&(F=this.isEmptyPosition(f,t)),F?(g=f,n.push(f),G++):(n=[r],g=r,G=1,A++,y++),y>E&&(y=0),A===E&&(I=!0,M=!0),G===T&&(M=!0)}return I?this.findPositions(o,t,i):n}createEmptyPosition(o){let t=this.createRandomPosition();return this.isEmptyPosition(t,o)?t:this.createEmptyPosition(o)}createRandomPosition(){let o=v(this._dimension),t=v(this._dimension);return c.createPosition(o,t)}isEmptyPosition(o,t){try{let i=t[o.x][o.y],{isShip:r}=i;return!r}catch(i){return!1}}insertShipOnBoard(o,t){return o.positions.forEach(i=>{let r=t[i.x][i.y];r.setShip(),t[i.x][i.y]=r}),t}}let O=(()=>{class e{constructor(){}createShip(t){return c.createShip(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Y=u(135),$=u(579);let C=(()=>{class e{constructor(){this._gameboard=new Y.X(c.createGameBoard(0,[])),this._shots=0,this._playAgain=new $.x}playAgain(){this._playAgain.next()}playAgainEvent(){return this._playAgain}getShots(){return this._shots}setShots(t){this._shots=t}getGameboard(){return this._gameboard}createGameboard(t,i){return c.createGameBoard(t,i)}loadGameboard(t){this._gameboard.next(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var S=(()=>{return(e=S||(S={})).DIMENSION="dimension",e.SHOTS="shots",S;var e})();let w=(()=>{class e{constructor(){}setLocal(t,i){let r=this.encrypt(i);localStorage.setItem(t,r)}setSession(t,i){if(a.debug(`${i}`),"string"==typeof i){let r=this.encrypt(i);sessionStorage.setItem(t,r)}}getLocal(t){let i=localStorage.getItem(t)||"";return this.decrypt(i)}getSession(t){a.debug(`${t}`);let i=sessionStorage.getItem(t)||"";return this.decrypt(i)}clearLocal(){localStorage.clear()}clearSession(){sessionStorage.clear()}encrypt(t){return btoa(t)}decrypt(t){return atob(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),B=(()=>{class e extends m{constructor(t){super(),this.storageService=t}getShots(){let t=this.storageService.getSession(S.SHOTS),i=0;try{i=JSON.parse(t)}catch(r){this.throwError("Error al tratar de transformar los tiros.")}return i}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(w))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),j=(()=>{class e{constructor(t,i,r){this.shipService=t,this.gameboardService=i,this.shotsService=r}ngOnInit(){this.listenPlayAgain()}listenPlayAgain(){this.gameboardService.playAgainEvent().subscribe(()=>{this.buildGame()})}buildGame(){a.debug("building..."),a.debug("creating ships...");let t=this.createShips();a.debug("creating gameboard...");let i=this.createGameboard(b.N.dimension,t),r=this.getShots();a.debug(`getting shots ${r}`),a.debug("load gameboard..."),this.gameboardService.setShots(r),this.gameboardService.loadGameboard(i)}createShips(){return[this.shipService.createShip(4),this.shipService.createShip(3),this.shipService.createShip(3),this.shipService.createShip(2),this.shipService.createShip(2),this.shipService.createShip(2),this.shipService.createShip(1),this.shipService.createShip(1),this.shipService.createShip(1),this.shipService.createShip(1)]}createGameboard(t,i){return this.gameboardService.createGameboard(t,i)}getShots(){return this.shotsService.getShots()}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(O),s.Y36(C),s.Y36(B))},e.\u0275cmp=s.Xpm({type:e,selectors:[["bts-battleship"]],decls:2,vars:0,consts:[[1,"p-12"]],template:function(t,i){1&t&&(s.TgZ(0,"div",0),s._UZ(1,"router-outlet"),s.qZA())},directives:[_.lC],styles:[""]}),e})();const U=function(e){return["gameboard__cell",e]};function D(e,o){if(1&e){const t=s.EpF();s.TgZ(0,"li",8),s.NdJ("click",function(){const n=s.CHM(t).index,g=s.oxw().index;return s.oxw(2).fireShot(g,n)}),s.qZA()}2&e&&s.Q6J("ngClass",s.VKq(1,U,"gameboard__cell--"+o.$implicit.state))}function H(e,o){if(1&e&&(s.TgZ(0,"ul",6),s.YNc(1,D,1,3,"li",7),s.qZA()),2&e){const t=o.$implicit;s.xp6(1),s.Q6J("ngForOf",t)}}function q(e,o){if(1&e&&(s.TgZ(0,"section",4),s.YNc(1,H,2,1,"ul",5),s.qZA()),2&e){const t=s.oxw();s.xp6(1),s.Q6J("ngForOf",t.getBoard())}}function Q(e,o){if(1&e&&(s.TgZ(0,"section",9)(1,"p"),s._uU(2),s.qZA(),s.TgZ(3,"p"),s._uU(4),s.qZA(),s.TgZ(5,"p"),s._uU(6),s.qZA(),s.TgZ(7,"p"),s._uU(8),s.qZA()()),2&e){const t=s.oxw();s.xp6(2),s.hij("dimension: ",t.gameboard.dimension,""),s.xp6(2),s.hij("barcos: ",t.gameboard.ships.length,""),s.xp6(2),s.hij("barcos hundidos: ",t.shipsDestroyed,""),s.xp6(2),s.hij("turnos: ",t.shots<0?"infinitos":t.shots,"")}}function X(e,o){if(1&e){const t=s.EpF();s.TgZ(0,"section",10)(1,"p",11),s._uU(2,"Game Over"),s.qZA(),s.TgZ(3,"button",12),s.NdJ("click",function(){return s.CHM(t),s.oxw().restart()}),s._uU(4," Intentar de nuevo "),s.qZA()()}}let W=(()=>{class e{constructor(t){this.gameboardService=t,this._shots=-1,this._shipsDestroyed=0}get shipsDestroyed(){return this._shipsDestroyed}get canPlay(){return 0!==this.shots}get gameboard(){return this._gameboard}get shots(){return this._shots}ngOnInit(){this.listenGameboardChanges(),this.restart()}restart(){this.gameboardService.playAgain()}listenGameboardChanges(){this.gameboardService.getGameboard().subscribe(t=>{a.debug(`gameboard are loaded with dimension ${t.dimension}`),this.getShots(),a.debug(`${this._shots}`),this.setGameboard(t)})}getShots(){let t=this.gameboardService.getShots();this.setShots(t)}setShots(t){this._shots=t}setGameboard(t){this._gameboard=t}fireShot(t,i){if(!this.canPlay)return;let r=this.getCell(t,i);if(r.state===p.CLEAN&&(this.decreaseShot(),a.debug(`fireShot is emitted on (${t},${i}) position`),r.setState(p.FAIL),r.isShip)){a.debug("this cell contain a ship: +1 hit");let n=this.findShip(t,i);n&&n.hit(),r.setState(p.HIT),(null==n?void 0:n.isDestroyed)&&(a.debug("this ship has been destroyed."),this.destroyShip(n))}}destroyShip(t){t.positions.forEach(({x:i,y:r})=>{this.getCell(i,r).setState(p.DESTROYED)}),this._shipsDestroyed++}findShip(t,i){let r=JSON.stringify({x:t,y:i});return this.getShips().find(n=>n.positions.join().includes(r))}getCell(t,i){return this.getBoard()[t][i]}getBoard(){return this._gameboard.board}getShips(){return this._gameboard.ships}decreaseShot(){this._shots--}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(C))},e.\u0275cmp=s.Xpm({type:e,selectors:[["bts-gameboard"]],decls:4,vars:3,consts:[[1,"flex","mx-auto","bg-white","rounded-xl","shadow-lg","items-center","p-6"],["class","gameboard",4,"ngIf"],["class","text-center flex-auto text-2xl",4,"ngIf"],["class","text-center flex-auto",4,"ngIf"],[1,"gameboard"],["class","gameboard__row",4,"ngFor","ngForOf"],[1,"gameboard__row"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"],[1,"text-center","flex-auto","text-2xl"],[1,"text-center","flex-auto"],[1,"mb-6","text-3xl","text-bold"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"]],template:function(t,i){1&t&&(s.TgZ(0,"div",0),s.YNc(1,q,2,1,"section",1),s.YNc(2,Q,9,4,"section",2),s.YNc(3,X,5,0,"section",3),s.qZA()),2&t&&(s.xp6(1),s.Q6J("ngIf",i.gameboard),s.xp6(1),s.Q6J("ngIf",i.canPlay&&i.gameboard),s.xp6(1),s.Q6J("ngIf",!i.canPlay))},directives:[d.O5,d.sg,d.mk],styles:["[_nghost-%COMP%]   .gameboard[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .gameboard__row[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .gameboard__cell[_ngcontent-%COMP%]{background-color:#d6f8b8;border:1px solid #74BEC1;width:48px;height:48px}[_nghost-%COMP%]   .gameboard__cell--clean[_ngcontent-%COMP%]:hover{background-color:#74bec1}[_nghost-%COMP%]   .gameboard__cell--hit[_ngcontent-%COMP%]{background-color:#f8b195}[_nghost-%COMP%]   .gameboard__cell--fail[_ngcontent-%COMP%]{background-color:#6b7b8e}[_nghost-%COMP%]   .gameboard__cell--destroyed[_ngcontent-%COMP%]{background-color:#f67280}"]}),e})();var l=u(382);function V(e,o){1&e&&(s.TgZ(0,"p",6),s._uU(1,"Ingresa un valor de turnos valido."),s.qZA())}const K=[{path:"",redirectTo:"battleship/menu"},{path:"battleship",component:j,children:[{path:"menu",component:(()=>{class e{constructor(t,i){this.storageService=t,this.router=i,this.shots=new l.NI(0,[l.kI.required,l.kI.min(0)])}ngOnInit(){}play(){let t=this.shots.value,i=Number(t);if(this.shots.valid&&i>0)return a.debug(`valid number of shots ${t}`),this.saveShots(t),this.goToGameboard();this.shots.setErrors({})}saveShots(t){this.storageService.setSession(S.SHOTS,t)}goToGameboard(){this.router.navigate(["battleship/gameboard"])}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(w),s.Y36(_.F0))},e.\u0275cmp=s.Xpm({type:e,selectors:[["bts-menu"]],decls:8,vars:2,consts:[[1,"text-center","items-center","max-w-xs","mx-auto","bg-white","rounded-xl","shadow-lg","p-6"],[1,"mb-4","text-left"],["for","turnos",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["id","shots","type","text","oninput","this.value = Math.round(this.value);","placeholder","numero de turnos",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"formControl"],["class","text-red-500 text-xs italic mt-2",4,"ngIf"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"],[1,"text-red-500","text-xs","italic","mt-2"]],template:function(t,i){1&t&&(s.TgZ(0,"form",0)(1,"div",1)(2,"label",2),s._uU(3," Ingrese el numero de turnos "),s.qZA(),s._UZ(4,"input",3),s.YNc(5,V,2,0,"p",4),s.qZA(),s.TgZ(6,"button",5),s.NdJ("click",function(){return i.play()}),s._uU(7," Iniciar juego "),s.qZA()()),2&t&&(s.xp6(4),s.Q6J("formControl",i.shots),s.xp6(1),s.Q6J("ngIf",i.shots.invalid))},directives:[l._Y,l.JL,l.F,l.Fj,l.JJ,l.oH,d.O5],styles:[""]}),e})()},{path:"gameboard",component:W}]}];let tt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[_.Bz.forChild(K)],_.Bz]}),e})(),et=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({providers:[C],imports:[[d.ez]]}),e})(),ot=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({providers:[O],imports:[[d.ez]]}),e})(),st=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({providers:[w],imports:[[d.ez]]}),e})(),it=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[d.ez,st,l.UX,l.u5]]}),e})(),rt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({providers:[B],imports:[[d.ez]]}),e})(),nt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[d.ez,tt,et,ot,it,rt]]}),e})()}}]);